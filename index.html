<!DOCTYPE html>

<!-- ****************************************************************************
++                                                                             ++
++         #######                          #####                              ++
++         #        #    #  ######  #####  #     #  ######  #    #             ++
++         #        ##  ##  #       #    # #        #       ##   #             ++
++         #####    # ## #  #####   #    # #  ####  #####   # #  #             ++
++         #        #    #  #       #####  #     #  #       #  # #             ++
++         #        #    #  #       #   #  #     #  #       #   ##             ++
++         #######  #    #  ######  #    #  #####   ######  #    #             ++
++                                                                             ++
++         EmerGen Emergent Behavior modeling                                  ++
++                                                                             ++
**         (c) Copyright 2018, Jonathan D. Lettvin                             ++
**             All rights reserved.                                            **
**                                                                             **
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
#     # ####### #     # #       #######
#     #    #    ##   ## #       #
#     #    #    # # # # #       #
#######    #    #  #  # #        #####
#     #    #    #     # #             #
#     #    #    #     # #       #     #
#     #    #    #     # #######  #####
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

<html>

<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
#     # #######    #    ######
#     # #         # #   #     #
#     # #        #   #  #     #
####### #####   #     # #     #
#     # #       ####### #     #
#     # #       #     # #     #
#     # ####### #     # ######
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
	<head>

		<meta charset="utf-8">
		<link rel="icon" href="EmerGen.gif" type="image/gif">

<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
######  ######  ####### #     # ####### #     #    #    #     #  #####  #######
#     # #     # #     # #     # #       ##    #   # #   ##    # #     # #
#     # #     # #     # #     # #       # #   #  #   #  # #   # #       #
######  ######  #     # #     # #####   #  #  # #     # #  #  # #       #####
#       #   #   #     #  #   #  #       #   # # ####### #   # # #       #
#       #    #  #     #   # #   #       #    ## #     # #    ## #     # #
#       #     # #######    #    ####### #     # #     # #     #  #####  #######
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

		<script type="text/javascript" language="javascript">
const __date       = "20180806"
const __author     = "jlettvin"
const __maintainer = "jlettvin"
const __email      = "jlettvin@gmail.com"
const __copyright  = "Copyright(c) 2018 Jonathan D. Lettvin, All Rights Reserved"
const __license    = "GPL V3.0"
const __status     = "Experiment"
const __version    = "0.0.1"
		</script>

<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 #####  ####### #     # #       #######
#     #    #     #   #  #       #
#          #      # #   #       #
 #####     #       #    #       #####
      #    #       #    #       #
#     #    #       #    #       #
 #####     #       #    ####### #######
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
		<link rel="stylesheet" href="index.css">
    </head>

<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
######  ####### ######  #     #
#     # #     # #     #  #   #
#     # #     # #     #   # #
######  #     # #     #    #
#     # #     # #     #    #
#     # #     # #     #    #
######  ####### ######     #
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

	<body>

<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    #######   ###   ####### #       #######
       #       #       #    #       #
       #       #       #    #       #
       #       #       #    #       #####
       #       #       #    #       #
       #       #       #    #       #
       #      ###      #    ####### #######
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

		<h1 class="hint title">
			<abbr title="1) consortium members. 2) setting for activity">
				<span class="RGBB">Emer</span>
				<span class="RGBG">Gen</span>
				<span class="RGBR">Tium</span>
			</abbr>
		</h1>>

<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    #     #   ###    #####  #     #    #    #         ###   ####### #######
    #     #    #    #     # #     #   # #   #          #         #  #
    #     #    #    #       #     #  #   #  #          #        #   #
    #     #    #     #####  #     # #     # #          #       #    #####
     #   #     #          # #     # ####### #          #      #     #
      # #      #    #     # #     # #     # #          #     #      #
       #      ###    #####   #####  #     # #######   ###   ####### #######
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

		<table width="100%">
			<tr><td>
				<h2>
					<abbr title="results of execution appear in the gray canvas">
						<b class="RGBB">EMER</b>GENT BEHAVIOR DISPLAY:
					</abbr>
				</h2>
			</td><td align="right">
				<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
				######  #     # ####### ####### ####### #     #  #####
				#     # #     #    #       #    #     # ##    # #     #
				#     # #     #    #       #    #     # # #   # #
				######  #     #    #       #    #     # #  #  #  #####
				#     # #     #    #       #    #     # #   # #       #
				#     # #     #    #       #    #     # #    ## #     #
				######   #####     #       #    ####### #     #  #####
				+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
				<button
					id="buttonTime"
					onmouseover="document.EmerGen.hintTime ();"
					onmouseout="document.EmerGen.hoverHint ();"
					onclick="document.EmerGen.eventTime ();"
					<abbr title="toggle model execution">
					MOVE
					</abbr>
				</button>
				<button
					id="buttonTalk"
					onmouseover="document.EmerGen.hintTalk ();"
					onmouseout="document.EmerGen.hoverHint ();"
					onclick="document.EmerGen.eventTalk ();"
					<abbr title="toggle javascript console logging">
					TALK</button>
					</abbr>
			</td></tr>
			<tr><td colspan="2" id="visualization">
				<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
				 #####     #    #     # #     #    #     #####
				#     #   # #   ##    # #     #   # #   #     #
				#        #   #  # #   # #     #  #   #  #
				#       #     # #  #  # #     # #     #  #####
				#       ####### #   # #  #   #  #######       #
				#     # #     # #    ##   # #   #     # #     #
				 #####  #     # #     #    #    #     #  #####
				+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
				<abbr title="place to observe consortium emergent behavior">
        			<canvas id="manifold">
					</canvas>
				</abbr>
			</td></tr>
		</table>

<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    ######  ######  #######  #####  ######     #    #     #
    #     # #     # #     # #     # #     #   # #   ##   ##
    #     # #     # #     # #       #     #  #   #  # # # #
    ######  ######  #     # #  #### ######  #     # #  #  #
    #       #   #   #     # #     # #   #   ####### #     #
    #       #    #  #     # #     # #    #  #     # #     #
    #       #     # #######  #####  #     # #     # #     #
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

		<h2>
			<abbr title="cut/paste or type program into the textarea below">
				CODE TO <b class="RGBG">GEN</b>ERATE CONSORTIUM:
			</abbr>
		</h2>
		<form role="form">
			<!-- https://codepen.io/davidelrizzo/pen/cxsGb -->
			<div class="form-group">
				<!--
			<button
				id="btn-save"
				type="submit"
				class="btn btn-primary"
				style="background-color:#cccccc;"
				onclick="document.EmerGen.fileSave ()"
				>
				Save to file
			</button>
			<input
				type="text"
				id="input-fileName"
				class="form-control"
				value="EmerGen.code.lsp"
				placeholder="Enter file name">
			</div>
			      -->
			<abbr title="code to be executed by consortium members">
			<textarea
				id="source"
				class="form-control"
				placeholder="Enter RPN programs here"
				onkeyup="document.EmerGen.main ();">
"Quoted strings are comments!"
.rpn          "Parse the program as RPN primitives (default)"
#20[1,1]      "Make 3x3 mesh (radius 1 from [0,0]) shown 20 frames per second"

$[1,:]        "In the last column, assign the following program to all cells"
2 3 + =A      "Add two numbers and store them in register A"
@A 5 - =@     "Subtract a number from register A and store as cell value"

$[-1:0,:]     "For all columns except the last"
9 =@          "Store 9 as cell value"

$[-1,+1]      "At absolute upper left corner" 
@[0,0]B =@    "Store last value from center cell register B as cell value"

.             "Run the programs in an infinite loop"
			</textarea>
			</abbr>

		<!-- file reader -->
		<script>
			function openSource (event) {
				var input = event.target;

				var reader = new FileReader ();
				reader.onload = function (){
					var text = reader.result;
					var output = document.getElementById ('source');
					output.innerHTML = text;
				};
				var blob = input.files[0];
				console.log ("BLOB", blob.name);
				reader.readAsText (blob);
				setSaveName (blob.name);
			};

			var setSaveName = function (file_name) {
				var a = document.getElementById('save');
				if (file_name) a.setAttribute('download', file_name);
			}
			//TODO set the contents just before save
			var setSaveText = function () {
				var a = document.getElementById ('save');
				var contents = document.getElementById ('source').innerHTML;
				//TODO why is this not filling properly?
				console.log (contents);
				var mime_type = 'data:text/plain';
				// text/html, image/png, etc
				mime_type = mime_type || 'application/octet-stream';
				a.href = 'data:'+ mime_type +';base64,'+ btoa(contents || '');
			};
		</script>
		<div style="background-color: white;">
			Load
			<input
				type='file'
				accept='text/*' onchange='openSource(event)'>
			<a
				id="save"
				download="earth.txt"
				onmouseenter="setSaveText();"
				href="data:text/plain,mostly harmless&#10;">Save</a>
		</div>
		</form>

<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    ######  ######  ####### ######  #       ####### #     #
    #     # #     # #     # #     # #       #       ##   ##
    #     # #     # #     # #     # #       #       # # # #
    ######  ######  #     # ######  #       #####   #  #  #
    #       #   #   #     # #     # #       #       #     #
    #       #    #  #     # #     # #       #       #     #
    #       #     # ####### ######  ####### ####### #     #
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

		<h2>
			<abbr title="Error messages appear here">
				STATUS OF CONSOR<b class="RGBR">TIUM</b>:
			</abbr>
		</h2>
		<textarea id="problem" placeholder="No problems"></textarea>

<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    #     #   ###   #     # #######  #####
    #     #    #    ##    #    #    #     #
    #     #    #    # #   #    #    #
    #######    #    #  #  #    #     #####
    #     #    #    #   # #    #          #
    #     #    #    #    ##    #    #     #
    #     #   ###   #     #    #     #####
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

		<h2>
			<abbr title="Instant advice appears here">
				HOVER HINTS
			</abbr>
		</h2>
		<textarea id="hoverHints" placeholder="Nothing under mouse"></textarea>

<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     #####  ####### ######  #     # ######    ###    #####  #     # #######
    #     # #     # #     #  #   #  #     #    #    #     # #     #    #
    #       #     # #     #   # #   #     #    #    #       #     #    #
    #       #     # ######     #    ######     #    #  #### #######    #
    #       #     # #          #    #   #      #    #     # #     #    #
    #     # #     # #          #    #    #     #    #     # #     #    #
     #####  ####### #          #    #     #   ###    #####  #     #    #
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

		<div class="footer" id="footer">
			<abbr title="email: jlettvin@gmail.com">
			EmerGen&trade;Copyright&copy;2018
			Jonathan D. Lettvin, All Rights Reserved.
			</abbr>
		</div>
	</body>

<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
####### #     # ######  ####### #######
   #    #     # #     # #       #
   #    #     # #     # #       #
   #    ####### ######  #####   #####
   #    #     # #   #   #       #
   #    #     # #    #  #       #
   #    #     # #     # ####### #######
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

	<script
		type="text/javascript"
		src="https://cdnjs.cloudflare.com/ajax/libs/three.js/94/three.min.js"
	></script>
	<script
		type="text/javascript"
		src="https://threejs.org/examples/js/controls/OrbitControls.js"
	></script>

<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   ##   #         ###    #####  ######    ##
  #     #          #    #     # #     #     #
 #      #          #    #       #     #      #
 #      #          #     #####  ######       #
 #      #          #          # #            #
  #     #          #    #     # #           #
   ##   #######   ###    #####  #         ##
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

	<script type="text/javascript" src="jth.js"></script>

<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   ##   ######  ######  ####### #       #     # ######  #######   ##
  #     #     # #     # #       #       #     # #     # #           #
 #      #     # #     # #       #       #     # #     # #            #
 #      ######  ######  #####   #       #     # #     # #####        #
 #      #       #   #   #       #       #     # #     # #            #
  #     #       #    #  #       #       #     # #     # #           #
   ##   #       #     # ####### #######  #####  ######  #######   ##
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

	<script type="text/lisp">
; This text used to be the contents of a file called prelude.lsp.
; It is part of the Javathcript suite.
; This file contains aliases and common definitions.
; It also imports the javascript Math functions.

(def + plus)
(def define def)
(def #t 't)
(def #f Nil)
(def nil Nil)
(def - minus)
(def / divide)
(def % rem)
(def * times)
(def = equal)
(def eq? equal)
(def head car)
(def first car)
(def tail cdr)
(def rest cdr)
(def eq equal)
(defun null (x) (equal x Nil))
(defun zerop (x) (equal x 0))
(defun plusp (x) (> x 0))
(defun minusp (x) (< x 0))
(defun evenp (x) (equal (rem x 2) 0))
(defun oddp (x) (/= (rem x 2) 1))
(defun list-member (E L)
	(cond ((null L) Nil)
		((equal E (first L))  't) ('t (list-member E (rest L)))))
(defun map (F L) (if (null L) Nil (cons (F (head L)) (map F (tail L)))))

; CADDRs

(defun caar (x) (car (car x)))
(defun cadr (x) (car (cdr x)))
(defun cdar (x) (cdr (car x)))
(defun cddr (x) (cdr (cdr x)))
(defun caaar (x) (car (car (car x))))
(defun caadr (x) (car (car (cdr x))))
(defun cadar (x) (car (cdr (car x))))
(defun caddr (x) (car (cdr (cdr x))))
(defun cdaar (x) (cdr (car (car x))))
(defun cdadr (x) (cdr (car (cdr x))))
(defun cddar (x) (cdr (cdr (car x))))
(defun cdddr (x) (cdr (cdr (cdr x))))
(defun caaaar (x) (car (car (car (car x)))))
(defun caaadr (x) (car (car (car (cdr x)))))
(defun caadar (x) (car (car (cdr (car x)))))
(defun caaddr (x) (car (car (cdr (cdr x)))))
(defun cadaar (x) (car (cdr (car (car x)))))
(defun cadadr (x) (car (cdr (car (cdr x)))))
(defun caddar (x) (car (cdr (cdr (car x)))))
(defun cadddr (x) (car (cdr (cdr (cdr x)))))
(defun cdaaar (x) (cdr (car (car (car x)))))
(defun cdaadr (x) (cdr (car (car (cdr x)))))
(defun cdadar (x) (cdr (car (cdr (car x)))))
(defun cdaddr (x) (cdr (car (cdr (cdr x)))))
(defun cddaar (x) (cdr (cdr (car (car x)))))
(defun cddadr (x) (cdr (cdr (car (cdr x)))))
(defun cdddar (x) (cdr (cdr (cdr (car x)))))
(defun cddddr (x) (cdr (cdr (cdr (cdr x)))))

; Some stuff specific to being run in a browser.

(def document (js "document"))
(def body (js "document.body"))
(def window (js "window"))
(def getElement (method document "getElementById"))
(def alert (method window "alert"))
(def message alert)
(def confirm (method window "confirm"))

; To be more like emacs, you might want to uncomment these two lines
; (def setp set)
; (def set def)

; Import PI and the javascript math functions.

(def PI (get (js "Math") "PI"))
(let*
	(	(math (js "Math"))
		(import-math (lambda (funcname)
							 (def-dyn funcname (method math funcname)))))
	(map import-math '(
		sin cos tan asin acos atan floor max min
		log abs ceil pow exp atan2 random sqrt round)))
	</script>

<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
#######                          #####
#        #    #  ######  #####  #     #  ######  #    #
#        ##  ##  #       #    # #        #       ##   #
#####    # ## #  #####   #    # #  ####  #####   # #  #
#        #    #  #       #####  #     #  #       #  # #
#        #    #  #       #   #  #     #  #       #   ##
#######  #    #  ######  #    #  #####   ######  #    #
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

	<!-- Primitives needed to load LISP and other useful predefinitions. -->
	<script type="text/javascript" src="general.js"></script>
	<script type="text/javascript" src="index.js"></script>
	<script type="text/javascript" src="hint.js"></script>
	<script type="text/javascript" src="language.js"></script>
	<script type="text/javascript" src="content/Template.js"></script>
	<script type="text/javascript" src="content/Contents.js"></script>
	<script type="text/javascript" src="main.js"></script>

<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   ##   #######                          #####                    ##
  #     #        #    #  ######  #####  #     #  ######  #    #     #
 #      #        ##  ##  #       #    # #        #       ##   #      #
 #      #####    # ## #  #####   #    # #  ####  #####   # #  #      #
 #      #        #    #  #       #####  #     #  #       #  # #      #
  #     #        #    #  #       #   #  #     #  #       #   ##     #
   ##   #######  #    #  ######  #    #  #####   ######  #    #   ##
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

	<script type="text/lisp">
(def E (get (js "Math") "E"))
(def console (js "console"))
(def log (method console "log"))
(def EmerGen (js "document.EmerGen"))
(def data0 (js "document.EmerGen.data0"))
(def cube (quote (
 ((0 0 0) (0 0 0) (0 0 0))
 ((0 0 0) (0 0 0) (0 0 0))
 ((0 0 0) (0 0 0) (0 0 0))
)))

(log 'hellisp)
(log cube)
(def console (js "console"))
(def log (method console "log"))
	</script>

</html>
